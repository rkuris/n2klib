<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>n2klib: n2klib</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">n2klib
   &#160;<span id="projectnumber">0.2</span>
   </div>
   <div id="projectbrief">NMEA2000_processing_library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">n2klib </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Unsatisifed with the size and quality of the NMEA 2000 libraries out there to interface with CAN, I decided to do a fresh start. The things I am after:</p>
<ul>
<li>Classes for each message. Since most of the time, applications only care about a few NMEA 2000 messages, I don't want all the code to encode or decode all of them, so they get built into separate files. If your code references them, they will be pulled in, otherwise not.</li>
<li>Separation of packet to message processing. The source of packets should be completely abstracted from the handling of them. There are readers and transmitters for linux canbus, as well as arduino.</li>
<li>Clean API. Create <a class="el" href="classn2k_1_1Receiver.html" title="Message assembler from Packet. ">n2k::Receiver</a>, add <a class="el" href="classn2k_1_1Callback.html" title="Holds a PGN and a callback function. ">n2k::Callback</a>, and call Receiver::ingest with your packets.</li>
<li>Fast discard. If nobody cares about a specific message PGN, then don't bother doing anything with it. On linux, this includes kernel filtering for efficiency.</li>
<li>Autogeneration. Classes should be generated from a DSL or another definition file, reducing the chance of a coding error on a particular message type, or some non-intuitive difference in handling a specific message.</li>
<li>Tests. I am a firm believer that the tests shouldn't need access to a CANbus. There should be unit tests that prove that each case works correctly.</li>
<li>Support for variable length stuff. Most of the libraries I saw didn't support things like a set of satellites in a message.</li>
<li>Minimal (perhaps zero) memory alloctions at runtime. Everything should be static if possible. That said, I'm sticking with &lt;vector&gt; for callbacks for the initial release. It would be nice to give a static CallbackList to a receiver.</li>
<li>Few dependencies. It needs to compile on arduino, which means most of the C++ standard library is off-limits. Currently uses &lt;functional&gt; and &lt;vector&gt;, both seems to have good implementations on arduino.</li>
<li>Message class generation uses the full library, so if you need to change the list of built classes, you'll need to run this on a linux box.</li>
<li>Single include. This is harder with multiple platforms, although as a library it's very nice to just include and be done with dependencies.</li>
</ul>
<h1>General Usage</h1>
<p>First, decide if you want a receiver or a transciever. If you want to transmit, you must receive for address negotiation.</p>
<p>For a receiver: </p><pre class="fragment">#include "n2k.h"
#include "generated/temperature.cc"

n2k::Receiver r;

void handler(const Packet &amp;p) {
    n2k::Temperature t(p);
    Serial.println(t.getActualTemperature())
}

void setup() {
    r.addListener(t, tempHandler)
}

void loop() {
    // read a Packet here
    Packet p = ...
    r.ingest(p);
}
</pre><p>Packet reading itself depends a lot on the device. On a teensy, you can use an event-based reader; see the examples directory for details. On linux, if you want to read from a can device, you can use <code><a class="el" href="n2ksocket_8h.html" title="Socket CAN (Linux only) ">n2ksocket.h</a></code> to define <code>SocketCanReceiver</code>, and use it like this: </p><pre class="fragment">#include "n2k.h"
#include "n2ksocket.h"
#include "generated/windData.cc"

void handleWind(const n2k::Message &amp; m);

int main(int argc, char *argv[])
{
    n2k::SocketCanReceiver r("can0");
    n2k::Callback cb(
        n2k::WindData::PGN,
        n2k::WindData::Type,
        handleWind);
    r.addCallback(cb);
    r.applyKernelFilter(); // optional
    r.run();
}</pre> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
